---
description: RFC 4302 - IP认证头，由S. Kent于2005年12月发布，描述了IP认证头（AH）的更新版本，旨在为IPv4和IPv6提供认证服务。文档取代了RFC 2402，定义了AH的格式、处理流程和完整性保护机制
keywords:
  - RFC4302
  - AH
  - Authentication Header
  - IP认证头
  - IPsec
  - 完整性
  - 认证
  - 防重放
  - SPI
  - 序列号
  - ICV
  - 完整性检查值
properties:
  rfc_number: 4302
  title: "IP Authentication Header"
  authors:
    - name: "S. Kent"
      organization: "BBN Technologies"
  publication_date: "2005-12"
  status: "标准跟踪协议"
  obsoletes: "RFC 2402"
  category: "IPsec协议"
  related_rfc:
    - "RFC 2402"
    - "RFC 4301"
    - "RFC 4303"
---
# RFC 4302 - IP认证头

## 文档概述

RFC 4302是由S. Kent于2005年12月发布的标准跟踪协议文档，标题为"IP Authentication Header"（IP认证头）。

该文档描述了IP认证头（AH）的更新版本，旨在为IPv4和IPv6提供认证服务。RFC 4302取代了RFC 2402（1998年11月）。

## 与仓库中其他RFC的关联

### IPsec协议族
- **RFC 4301**（已在仓库中）：IPsec安全架构，定义了AH在IPsec中的角色
- **RFC 2401**（已在仓库中）：被RFC 4301取代的旧版IPsec架构
- **RFC 4303**：ESP协议，与AH并列的另一个IPsec安全协议

### 取代关系
- **RFC 2402**（已在仓库中）：RFC 4302取代了RFC 2402，是AH协议的更新版本

## AH协议的作用

AH提供以下安全服务：
1. **数据完整性**：确保数据在传输过程中未被修改
2. **数据源认证**：验证数据包的来源
3. **防重放攻击**：防止攻击者重放旧的数据包

**注意**：AH不提供加密服务，数据内容仍然是明文传输。

## 认证头格式

AH头部包含以下字段：

### 1. Next Header（下一个头部）
- 8位字段
- 标识紧跟在AH后面的协议类型
- 与IPv4的Protocol字段或IPv6的Next Header字段含义相同

### 2. Payload Length（载荷长度）
- 8位字段
- 以32位字为单位的AH长度减2
- 用于确定AH头部的总长度

### 3. Reserved（保留）
- 16位字段
- 保留供将来使用
- 发送时必须设置为0

### 4. Security Parameters Index (SPI)
- 32位字段
- 与目标IP地址和安全协议一起唯一标识SA
- 接收方使用SPI查找相应的安全关联

### 5. Sequence Number（序列号）
- 32位字段
- 单调递增的计数器
- 用于防重放攻击
- 支持扩展的64位序列号（可选）

### 6. Integrity Check Value (ICV)
- 可变长度字段
- 包含完整性检查值（消息认证码）
- 长度由使用的认证算法决定
- 保护整个IP数据包（包括某些IP头部字段）

## AH的两种模式

### 传输模式（Transport Mode）

**用途**：主机到主机的通信

**特点**：
- AH插入在IP头部和上层协议之间
- 保护上层协议数据
- 不改变IP头部（除了某些字段）
- 适用于端到端的安全

### 隧道模式（Tunnel Mode）

**用途**：网关到网关或主机到网关的通信

**特点**：
- 整个原始IP数据包被封装
- AH插入在新的外部IP头部和原始IP数据包之间
- 保护整个原始IP数据包
- 适用于VPN场景

## 出站数据包处理

### 1. 安全关联查找
- 根据SPD策略查找相应的SA
- 获取SA参数（算法、密钥等）

### 2. 序列号生成
- 递增序列号计数器
- 将序列号插入AH头部
- 检查序列号是否溢出

### 3. 完整性检查值计算
- 处理可变字段（设置为0或预测值）
- 计算整个数据包的ICV
- 将ICV插入AH头部

## 入站数据包处理

### 1. 安全关联查找
- 使用SPI、目标地址和协议查找SA
- 如果找不到SA，丢弃数据包

### 2. 序列号验证
- 检查序列号是否在防重放窗口内
- 检测并拒绝重放的数据包

### 3. 完整性检查值验证
- 重新计算ICV
- 与接收到的ICV比较
- 如果不匹配，丢弃数据包

## 与RFC 2402的差异

RFC 4302相对于RFC 2402的主要改进：

### 1. 扩展序列号支持
- 新增64位扩展序列号选项
- 提供更强的防重放保护
- 适用于高速网络环境

### 2. 改进的可变字段处理
- 更清晰的可变字段定义
- 改进的IPv6扩展头处理
- 更详细的处理规则

### 3. 增强的处理模型
- 更详细的出站和入站处理流程
- 改进的错误处理
- 更清晰的实现指导

## 总结

RFC 4302作为IP认证头协议的更新标准，为IPv4和IPv6提供了强大的认证和完整性保护机制。

**核心贡献**：

1. **完整性保护**：通过ICV确保数据未被篡改
2. **数据源认证**：验证数据包的真实来源
3. **防重放保护**：通过序列号机制防止重放攻击
4. **双模式支持**：传输模式和隧道模式满足不同场景需求

**与ESP的对比**：

AH与ESP（RFC 4303）是IPsec的两个核心协议：
- **AH**：提供认证和完整性，但不加密
- **ESP**：提供认证、完整性和加密
- 可以单独使用或组合使用

**实践价值**：

RFC 4302为需要认证但不需要加密的场景提供了解决方案：
- 内部网络通信
- 需要验证数据来源的场景
- 法规要求不能加密的环境

## 参考资料

### 被取代的RFC
1. RFC 2402: IP Authentication Header（1998年11月）

### IPsec架构RFC（仓库中已有）
2. RFC 4301: Security Architecture for the Internet Protocol
3. RFC 2401: Security Architecture for the Internet Protocol（被RFC 4301取代）

### 相关协议RFC
4. RFC 4303: IP Encapsulating Security Payload (ESP)
5. RFC 2406: IP Encapsulating Security Payload (ESP)（被RFC 4303取代，仓库中已有）
